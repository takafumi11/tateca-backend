openapi: 3.1.0
info:
  title: Tateca API
  description: "Group expense management API with multi-currency support. Track expenses,\
    \ loans, and settlements across multiple users and currencies."
  contact:
    name: Tateca Team
    url: https://tateca.net
    email: support@tateca.net
  license:
    name: Proprietary
    url: https://tateca.net/terms
  version: 1.0.0
externalDocs:
  description: Full Documentation
  url: https://docs.tateca.net
servers:
- url: http://localhost:8080
  description: Local Development
- url: https://staging-api.tateca.net
  description: Staging
- url: https://api.tateca.net
  description: Production
security:
- bearerAuth: []
tags:
- name: Groups
  description: Group management operations
- name: Users
  description: User management operations
- name: Actuator
  description: Monitor and interact
  externalDocs:
    description: Spring Boot Actuator Web API Documentation
    url: https://docs.spring.io/spring-boot/docs/current/actuator-api/html/
- name: Internal
  description: Internal system operations (EventBridge + Lambda)
- name: Transactions
  description: Transaction management operations
- name: Auth Users
  description: Authenticated user management operations
- name: Exchange Rates
  description: Currency exchange rate operations
paths:
  /internal/exchange-rates:
    post:
      tags:
      - Internal
      summary: Update exchange rates (fetches latest rates)
      description: |
        Triggered by AWS EventBridge + Lambda to update daily exchange rates.

        **Authentication:** Requires X-API-Key header

        **Flow:**
        1. Lambda receives EventBridge trigger (daily at 00:01 UTC)
        2. Lambda calls this endpoint
        3. System fetches LATEST rates from external API
        4. Rates are saved/updated in database with current date

        **Request Body:** Not required
      operationId: updateExchangeRates
      responses:
        "204":
          description: Exchange rates updated successfully
        "500":
          description: Internal server error - External API unavailable or database
            error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: 500
                message: Exchange rate service unavailable
        "401":
          description: Unauthorized - Missing or invalid X-API-Key header
          content:
            application/json:
              example:
                status: 401
                message: Invalid API Key
      security:
      - ApiKeyAuth: []
  /groups:
    post:
      tags:
      - Groups
      summary: Create a new group
      operationId: createGroup
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateGroupRequestDTO"
        required: true
      responses:
        "400":
          description: Validation error - Invalid request parameters
          content:
            application/json:
              examples:
                Empty or blank group name:
                  description: "When group_name is null, empty string, or only whitespace"
                  value:
                    status: 400
                    message: "groupName: Group name is required"
                Group name exceeds maximum length:
                  description: When group_name exceeds 100 characters
                  value:
                    status: 400
                    message: "groupName: Group name must be between 1 and 100 characters"
                Empty or blank host name:
                  description: "When host_name is null, empty string, or only whitespace"
                  value:
                    status: 400
                    message: "hostName: Host name is required"
                Host name exceeds maximum length:
                  description: When host_name exceeds 50 characters
                  value:
                    status: 400
                    message: "hostName: Host name must be between 1 and 50 characters"
                Empty participants list:
                  description: When participants_name list is empty
                  value:
                    status: 400
                    message: "participantsName: Participants must be between 1 and\
                      \ 8"
                Participants list exceeds maximum size:
                  description: When participants_name list has more than 8 members
                  value:
                    status: 400
                    message: "participantsName: Participants must be between 1 and\
                      \ 8"
                Participant name is blank:
                  description: When a participant name in the list is blank
                  value:
                    status: 400
                    message: "participantsName[]: Participant name cannot be blank"
                Participant name exceeds maximum length:
                  description: When a participant name exceeds 50 characters
                  value:
                    status: 400
                    message: "participantsName[]: Participant name must be between\
                      \ 1 and 50 characters"
        "409":
          description: Conflict - User has reached maximum group limit
          content:
            application/json:
              example:
                status: 409
                message: can't join more than 10 groups
        "201":
          description: Group created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GroupResponseDTO"
        "415":
          description: Unsupported Media Type - Content-Type header must be application/json
          content:
            application/json:
              example:
                status: 415
                message: Unsupported Media Type. Content-Type must be application/json
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
  /groups/{groupId}:
    get:
      tags:
      - Groups
      summary: Get group information by ID
      operationId: getGroupInfo
      parameters:
      - name: groupId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "404":
          description: Group not found
          content:
            application/json:
              example:
                status: 404
                message: Group Not Found
        "200":
          description: Group information retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GroupResponseDTO"
        "400":
          description: Validation error - Invalid UUID format
          content:
            application/json:
              examples:
                Invalid UUID format:
                  description: When groupId path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'groupId': expected UUID"
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
    post:
      tags:
      - Groups
      summary: Join a group using invitation token
      operationId: joinGroupInvited
      parameters:
      - name: groupId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JoinGroupRequestDTO"
        required: true
      responses:
        "404":
          description: Group not found
          content:
            application/json:
              example:
                status: 404
                message: Group not found
        "409":
          description: Conflict - User already member of the group
          content:
            application/json:
              example:
                status: 409
                message: already joined this group
        "200":
          description: User joined group successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GroupResponseDTO"
        "400":
          description: Validation error - Invalid request parameters
          content:
            application/json:
              examples:
                User UUID is null:
                  description: When user_uuid is null
                  value:
                    status: 400
                    message: "userUuid: User UUID is required"
                Join token is null:
                  description: When join_token is null
                  value:
                    status: 400
                    message: "joinToken: Join token is required"
                Invalid UUID format for user_uuid:
                  description: When user_uuid has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid value for field 'user_uuid': expected UUID but\
                      \ received String"
                Invalid UUID format for groupId:
                  description: When groupId path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'groupId': expected UUID"
        "403":
          description: Forbidden - Invalid join token
          content:
            application/json:
              example:
                status: 403
                message: Invalid join token
        "415":
          description: Unsupported Media Type - Content-Type header must be application/json
          content:
            application/json:
              example:
                status: 415
                message: Unsupported Media Type. Content-Type must be application/json
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
    patch:
      tags:
      - Groups
      summary: Update group name
      operationId: updateGroupName
      parameters:
      - name: groupId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateGroupNameRequestDTO"
        required: true
      responses:
        "400":
          description: Validation error - Invalid request parameters
          content:
            application/json:
              examples:
                Empty or blank group name:
                  description: "When group_name is null, empty string, or only whitespace"
                  value:
                    status: 400
                    message: "groupName: Group name is required"
                Group name exceeds maximum length:
                  description: When group_name exceeds 100 characters
                  value:
                    status: 400
                    message: "groupName: Group name must be between 1 and 100 characters"
                Invalid UUID format:
                  description: When groupId path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'groupId': expected UUID"
        "200":
          description: Group name updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GroupResponseDTO"
        "404":
          description: Group not found
          content:
            application/json:
              example:
                status: 404
                message: group not found
        "415":
          description: Unsupported Media Type - Content-Type header must be application/json
          content:
            application/json:
              example:
                status: 415
                message: Unsupported Media Type. Content-Type must be application/json
        "403":
          description: Forbidden - User doesn't have permission to update this group
          content:
            application/json:
              example:
                status: 403
                message: Forbidden
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
  /groups/{groupId}/transactions:
    post:
      tags:
      - Transactions
      summary: Create a new transaction
      operationId: createTransaction
      parameters:
      - name: groupId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTransactionRequestDTO"
        required: true
      responses:
        "404":
          description: Group not found
          content:
            application/json:
              example:
                status: 404
                message: Group not found
        "400":
          description: Validation error - Invalid request parameters
          content:
            application/json:
              examples:
                Transaction type is null:
                  description: When transaction_type is null
                  value:
                    status: 400
                    message: "transactionType: Transaction type is required"
                Title is blank or null:
                  description: "When title is null, empty string, or only whitespace"
                  value:
                    status: 400
                    message: "title: Title is required"
                Title exceeds maximum length:
                  description: When title exceeds 50 characters
                  value:
                    status: 400
                    message: "title: Title must not exceed 50 characters"
                Amount is null, zero, or negative:
                  description: "When amount is null, zero, or negative number"
                  value:
                    status: 400
                    message: "amount: Amount must be a positive number"
                Currency code is invalid:
                  description: "When currency_code is blank, not uppercase, or not\
                    \ 3 characters"
                  value:
                    status: 400
                    message: "currencyCode: Currency code must be 3 uppercase letters\
                      \ (ISO 4217)"
                Date format is invalid:
                  description: "When date_str is not ISO 8601 format with timezone\
                    \ (e.g., 2024-01-15T18:30:00+09:00)"
                  value:
                    status: 400
                    message: "dateStr: Date must be in ISO 8601 format with timezone"
                Payer ID is null:
                  description: When payer_id is null
                  value:
                    status: 400
                    message: "payerId: Payer ID is required"
                LOAN without loan details:
                  description: When transaction_type is LOAN but loan field is null
                  value:
                    status: 400
                    message: LOAN transaction must have loan details
                REPAYMENT without repayment details:
                  description: When transaction_type is REPAYMENT but repayment field
                    is null
                  value:
                    status: 400
                    message: REPAYMENT transaction must have repayment details
                Obligations list is empty or exceeds maximum:
                  description: When obligations list is empty or has more than 8 items
                  value:
                    status: 400
                    message: "obligations: Obligations must have between 1 and 8 items"
                Obligation amount is invalid:
                  description: "When obligation amount is null, zero, or negative"
                  value:
                    status: 400
                    message: "obligations[].amount: Amount must be a positive number"
                Obligation user UUID is null:
                  description: When obligation user_uuid is null
                  value:
                    status: 400
                    message: "obligations[].userUuid: User UUID is required"
        "201":
          description: Transaction created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateTransactionResponseDTO"
        "415":
          description: Unsupported Media Type - Content-Type header must be application/json
          content:
            application/json:
              example:
                status: 415
                message: Unsupported Media Type. Content-Type must be application/json
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
  /auth/users:
    post:
      tags:
      - Auth Users
      summary: Create new authenticated user
      description: Registers a new authenticated user in the system
      operationId: createAuthUser
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAuthUserRequestDTO"
        required: true
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUserResponseDTO"
        "401":
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
        "409":
          description: Conflict - User already exists
          content:
            application/json:
              example:
                status: 409
                message: Email already exists
        "500":
          description: Internal Server Error
          content:
            application/json:
              example:
                status: 500
                message: Database error
        "400":
          description: Validation error - Invalid request parameters
          content:
            application/json:
              examples:
                Email is null, empty, or whitespace only:
                  description: "When email is null, empty string, or only whitespace"
                  value:
                    status: 400
                    message: "email: Email is required and cannot be blank"
                Email exceeds maximum length:
                  description: When email exceeds 255 characters
                  value:
                    status: 400
                    message: "email: Email must not exceed 255 characters"
                Malformed JSON:
                  description: When request body is not valid JSON
                  value:
                    status: 400
                    message: Invalid request body format. Please check the data types
                      and structure.
        "415":
          description: Unsupported Media Type - Content-Type header must be application/json
          content:
            application/json:
              example:
                status: 415
                message: Unsupported Media Type. Content-Type must be application/json
  /users/{userId}:
    patch:
      tags:
      - Users
      summary: Update user name
      operationId: updateUserName
      parameters:
      - name: userId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserNameRequestDTO"
        required: true
      responses:
        "200":
          description: User name updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponseDTO"
        "400":
          description: Validation error - Invalid request parameters
          content:
            application/json:
              examples:
                Empty or blank name:
                  description: "When user_name is null, empty string, or only whitespace"
                  value:
                    status: 400
                    message: "name: User name is required and cannot be blank"
                Name exceeds maximum length:
                  description: When user_name exceeds 50 characters
                  value:
                    status: 400
                    message: "name: User name must be between 1 and 50 characters"
                Invalid UUID format:
                  description: When userId path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'userId': expected UUID"
                Malformed JSON:
                  description: When request body is not valid JSON
                  value:
                    status: 400
                    message: Invalid request body format. Please check the data types
                      and structure.
        "500":
          description: Internal Server Error
          content:
            application/json:
              example:
                status: 500
                message: An unexpected error occurred
        "415":
          description: Unsupported Media Type - Content-Type header must be application/json
          content:
            application/json:
              example:
                status: 415
                message: Unsupported Media Type. Content-Type must be application/json
        "404":
          description: User not found
          content:
            application/json:
              example:
                status: 404
                message: User not found
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
  /auth/users/review-preferences:
    patch:
      tags:
      - Auth Users
      summary: Update app review preferences
      description: Updates the app review preferences for an authenticated user
      operationId: updateReviewPreferences
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateAppReviewRequestDTO"
        required: true
      responses:
        "200":
          description: Review preferences updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUserResponseDTO"
        "401":
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
        "500":
          description: Internal Server Error
          content:
            application/json:
              example:
                status: 500
                message: Database error
        "404":
          description: User not found - The specified UID does not exist
          content:
            application/json:
              example:
                status: 404
                message: User not found
        "415":
          description: Unsupported Media Type - Content-Type header must be application/json
          content:
            application/json:
              example:
                status: 415
                message: Unsupported Media Type. Content-Type must be application/json
        "400":
          description: Validation error - Invalid request parameters
          content:
            application/json:
              examples:
                App review status is null:
                  description: When app_review_status is null
                  value:
                    status: 400
                    message: "appReviewStatus: App review status is required"
                Invalid ENUM value:
                  description: "When app_review_status is not a valid enum value (PENDING,\
                    \ COMPLETED, PERMANENTLY_DECLINED)"
                  value:
                    status: 400
                    message: "Invalid value for app_review_status: must be PENDING,\
                      \ COMPLETED, or PERMANENTLY_DECLINED"
                Malformed JSON:
                  description: When request body is not valid JSON
                  value:
                    status: 400
                    message: Invalid request body format. Please check the data types
                      and structure.
  /groups/{groupId}/transactions/{transactionId}:
    get:
      tags:
      - Transactions
      summary: Get transaction details by ID
      operationId: getTransactionDetail
      parameters:
      - name: groupId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: transactionId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "400":
          description: Validation error - Invalid UUID format
          content:
            application/json:
              examples:
                Invalid groupId UUID format:
                  description: When groupId path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'groupId': expected UUID"
                Invalid transactionId UUID format:
                  description: When transactionId path parameter has invalid UUID
                    format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'transactionId': expected\
                      \ UUID"
        "404":
          description: Transaction not found
          content:
            application/json:
              example:
                status: 404
                message: Transaction not found
        "200":
          description: Transaction details retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateTransactionResponseDTO"
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
    delete:
      tags:
      - Transactions
      summary: Delete a transaction
      operationId: deleteLoan
      parameters:
      - name: groupId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: transactionId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "400":
          description: Validation error - Invalid UUID format
          content:
            application/json:
              examples:
                Invalid groupId UUID format:
                  description: When groupId path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'groupId': expected UUID"
                Invalid transactionId UUID format:
                  description: When transactionId path parameter has invalid UUID
                    format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'transactionId': expected\
                      \ UUID"
        "204":
          description: Transaction deleted successfully
        "404":
          description: Transaction not found
          content:
            application/json:
              example:
                status: 404
                message: Transaction not found
        "403":
          description: Forbidden - User doesn't have permission to delete this transaction
          content:
            application/json:
              example:
                status: 403
                message: Forbidden
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
  /groups/{groupId}/transactions/settlement:
    get:
      tags:
      - Transactions
      summary: Get settlement information for a group in JPY
      operationId: getTransactionSettlement
      parameters:
      - name: groupId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "200":
          description: Settlement information retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionSettlementResponseDTO"
        "404":
          description: Group not found
          content:
            application/json:
              example:
                status: 404
                message: Group not found
        "400":
          description: Validation error - Invalid UUID format
          content:
            application/json:
              examples:
                Invalid UUID format:
                  description: When groupId path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'groupId': expected UUID"
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
  /groups/{groupId}/transactions/history:
    get:
      tags:
      - Transactions
      summary: Get transaction history for a group
      description: "Retrieve transaction history with optional count parameter (default:\
        \ 5)"
      operationId: getTransactionHistory
      parameters:
      - name: count
        in: query
        required: false
        schema:
          type: integer
          format: int32
          default: 5
      - name: groupId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "404":
          description: Group not found
          content:
            application/json:
              example:
                status: 404
                message: Group not found
        "200":
          description: Transaction history retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionHistoryResponseDTO"
        "400":
          description: Validation error - Invalid UUID format
          content:
            application/json:
              examples:
                Invalid UUID format:
                  description: When groupId path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'groupId': expected UUID"
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
  /groups/list:
    get:
      tags:
      - Groups
      summary: Get list of groups for the current user
      operationId: getGroupList
      responses:
        "200":
          description: Group list retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GroupListResponseDTO"
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
  /exchange-rate/{date}:
    get:
      tags:
      - Exchange Rates
      summary: Get exchange rates for a specific date
      description: Retrieve exchange rates for a specific date in ISO 8601 format
        (YYYY-MM-DD)
      operationId: getExchangeRate
      parameters:
      - name: date
        in: path
        required: true
        schema:
          type: string
          format: date
      responses:
        "200":
          description: Exchange rates retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ExchangeRateResponseDTO"
        "404":
          description: Exchange rates not found for the specified date
          content:
            application/json:
              example:
                status: 404
                message: Exchange rates not found for date
        "500":
          description: Internal Server Error
          content:
            application/json:
              example:
                status: 500
                message: Database connection error
        "400":
          description: Validation error - Invalid date format
          content:
            application/json:
              examples:
                Invalid date format:
                  description: "When date is not in ISO 8601 format (YYYY-MM-DD) or\
                    \ invalid date (e.g., 2024-13-45)"
                  value:
                    status: 400
                    message: "Invalid date format: expected ISO 8601 date (YYYY-MM-DD)"
                Malformed date string:
                  description: When date parameter is not a valid date string
                  value:
                    status: 400
                    message: Failed to convert value of type 'java.lang.String' to
                      required type 'java.time.LocalDate'
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
  /auth/users/{uid}:
    get:
      tags:
      - Auth Users
      summary: Get authenticated user information
      description: Retrieves detailed information about an authenticated user by their
        UID
      operationId: getAuthUser
      parameters:
      - name: uid
        in: path
        required: true
        schema:
          type: string
          maxLength: 128
          minLength: 0
      responses:
        "200":
          description: User information retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthUserResponseDTO"
        "400":
          description: Validation error - Invalid UID format
          content:
            application/json:
              example:
                status: 400
                message: Invalid UID format
        "404":
          description: User not found - The specified UID does not exist
          content:
            application/json:
              example:
                status: 404
                message: User not found
    delete:
      tags:
      - Auth Users
      summary: Delete authenticated user
      description: Removes an authenticated user from the system
      operationId: deleteUserInfo
      parameters:
      - name: uid
        in: path
        required: true
        schema:
          type: string
          maxLength: 128
          minLength: 0
      responses:
        "400":
          description: Validation error - Invalid UID format
          content:
            application/json:
              example:
                status: 400
                message: Invalid UID format
        "404":
          description: User not found - The specified UID does not exist
          content:
            application/json:
              example:
                status: 404
                message: User not found
        "204":
          description: User deleted successfully
  /actuator:
    get:
      tags:
      - Actuator
      summary: Actuator root web endpoint
      operationId: links
      responses:
        "200":
          description: OK
          content:
            application/vnd.spring-boot.actuator.v3+json:
              schema:
                type: object
                additionalProperties:
                  type: object
                  additionalProperties:
                    $ref: "#/components/schemas/Link"
            application/vnd.spring-boot.actuator.v2+json:
              schema:
                type: object
                additionalProperties:
                  type: object
                  additionalProperties:
                    $ref: "#/components/schemas/Link"
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: object
                  additionalProperties:
                    $ref: "#/components/schemas/Link"
  /actuator/prometheus:
    get:
      tags:
      - Actuator
      summary: Actuator web endpoint 'prometheus'
      operationId: scrape
      parameters:
      - name: format
        in: query
        schema:
          type: string
          enum:
          - CONTENT_TYPE_004
          - CONTENT_TYPE_OPENMETRICS_100
          - CONTENT_TYPE_PROTOBUF
      - name: includedNames
        in: query
        schema: {}
      responses:
        "200":
          description: OK
          content:
            text/plain;version=0.0.4;charset=utf-8:
              schema: {}
            application/openmetrics-text;version=1.0.0;charset=utf-8:
              schema: {}
            application/vnd.google.protobuf;proto=io.prometheus.client.MetricFamily;encoding=delimited:
              schema: {}
  /actuator/metrics:
    get:
      tags:
      - Actuator
      summary: Actuator web endpoint 'metrics'
      operationId: listNames
      responses:
        "200":
          description: OK
          content:
            application/vnd.spring-boot.actuator.v3+json:
              schema: {}
            application/vnd.spring-boot.actuator.v2+json:
              schema: {}
            application/json:
              schema: {}
  /actuator/metrics/{requiredMetricName}:
    get:
      tags:
      - Actuator
      summary: Actuator web endpoint 'metrics-requiredMetricName'
      operationId: metric
      parameters:
      - name: requiredMetricName
        in: path
        required: true
        schema:
          type: string
      - name: tag
        in: query
        schema: {}
      responses:
        "200":
          description: OK
          content:
            application/vnd.spring-boot.actuator.v3+json:
              schema: {}
            application/vnd.spring-boot.actuator.v2+json:
              schema: {}
            application/json:
              schema: {}
        "404":
          description: Not Found
  /actuator/health:
    get:
      tags:
      - Actuator
      summary: Actuator web endpoint 'health'
      operationId: health
      responses:
        "200":
          description: OK
          content:
            application/vnd.spring-boot.actuator.v3+json:
              schema: {}
            application/vnd.spring-boot.actuator.v2+json:
              schema: {}
            application/json:
              schema: {}
  /groups/{groupId}/users/{userUuid}:
    delete:
      tags:
      - Groups
      summary: Leave a group
      operationId: leaveGroup
      parameters:
      - name: groupId
        in: path
        required: true
        schema:
          type: string
          format: uuid
      - name: userUuid
        in: path
        required: true
        schema:
          type: string
          format: uuid
      responses:
        "204":
          description: User left group successfully
        "404":
          description: Group not found
          content:
            application/json:
              example:
                status: 404
                message: Group not found
        "400":
          description: Validation error - Invalid UUID format
          content:
            application/json:
              examples:
                Invalid groupId UUID format:
                  description: When groupId path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'groupId': expected UUID"
                Invalid userUuid UUID format:
                  description: When userUuid path parameter has invalid UUID format
                  value:
                    status: 400
                    message: "Invalid format for parameter 'userUuid': expected UUID"
        "403":
          description: Forbidden - User doesn't have permission to remove this user
          content:
            application/json:
              example:
                status: 403
                message: Forbidden
        "401":
          description: Unauthorized - Invalid or missing Firebase JWT token
          content:
            application/json:
              example:
                status: 401
                message: Unauthorized
components:
  schemas:
    ErrorResponse:
      type: object
      properties:
        status:
          type: integer
          format: int32
        message:
          type: string
    CreateGroupRequestDTO:
      type: object
      description: Request to create a new group
      properties:
        group_name:
          type: string
          description: Name of the group
          example: Team Outing 2024
          maxLength: 100
          minLength: 1
        host_name:
          type: string
          description: Name of the group host
          example: John Doe
          maxLength: 50
          minLength: 1
        participants_name:
          type: array
          description: "List of participant names (minimum 1, maximum 8)"
          example:
          - Alice
          - Bob
          - Charlie
          items:
            type: string
            maxLength: 50
            minLength: 1
          maxItems: 8
          minItems: 1
      required:
      - group_name
      - host_name
      - participants_name
    AuthUserResponseDTO:
      type: object
      description: Authentication user information
      properties:
        uid:
          type: string
          description: Firebase authentication user ID
          example: firebase-uid-123
        name:
          type: string
          description: User's name from authentication provider
          example: John Doe
        email:
          type: string
          description: User's email address
          example: john.doe@example.com
        created_at:
          type: string
          description: Account creation timestamp (Tokyo time)
          example: 2024-01-01T12:00:00+09:00
        updated_at:
          type: string
          description: Last update timestamp (Tokyo time)
          example: 2024-01-15T14:30:00+09:00
        last_login_time:
          type: string
          description: Last login timestamp (Tokyo time)
          example: 2024-01-20T10:15:00+09:00
        total_login_count:
          type: integer
          format: int32
          description: Total number of logins
          example: 42
        last_app_review_dialog_shown_at:
          type: string
          description: Timestamp when app review dialog was last shown (Tokyo time)
          example: 2024-01-18T16:45:00+09:00
        app_review_status:
          type: string
          description: Current app review status
          enum:
          - PENDING
          - COMPLETED
          - PERMANENTLY_DECLINED
    GroupResponse:
      type: object
      description: Group information
      properties:
        uuid:
          type: string
          description: Group's unique identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          description: Group name
          example: Team Outing 2024
        join_token:
          type: string
          description: Invitation token for joining the group
          example: 123e4567-e89b-12d3-a456-426614174000
        token_expires:
          type: string
          description: Token expiration date
          example: 2024-12-31
        created_at:
          type: string
          description: Group creation timestamp (Tokyo time)
          example: 2024-01-01T12:00:00+09:00
        updated_at:
          type: string
          description: Group last update timestamp (Tokyo time)
          example: 2024-01-15T14:30:00+09:00
    GroupResponseDTO:
      type: object
      description: Detailed group information including members and statistics
      properties:
        group:
          $ref: "#/components/schemas/GroupResponse"
          description: Group information
        users:
          type: array
          description: List of users in the group
          items:
            $ref: "#/components/schemas/UserResponseDTO"
        transaction_count:
          type: integer
          format: int64
          description: Total number of transactions in the group
          example: 42
    UserResponseDTO:
      type: object
      description: User information response
      properties:
        uuid:
          type: string
          description: User's unique identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        name:
          type: string
          description: User's display name
          example: John Doe
        auth_user:
          $ref: "#/components/schemas/AuthUserResponseDTO"
          description: Authentication user details
        created_at:
          type: string
          description: User creation timestamp (Tokyo time)
          example: 2024-01-01T12:00:00+09:00
        updated_at:
          type: string
          description: User last update timestamp (Tokyo time)
          example: 2024-01-15T14:30:00+09:00
    JoinGroupRequestDTO:
      type: object
      description: Request to join a group using invitation token
      properties:
        user_uuid:
          type: string
          format: uuid
          description: UUID of the user joining the group
          example: 550e8400-e29b-41d4-a716-446655440000
        join_token:
          type: string
          format: uuid
          description: Invitation token for joining the group
          example: 123e4567-e89b-12d3-a456-426614174000
      required:
      - join_token
      - user_uuid
    CreateTransactionRequestDTO:
      type: object
      description: Request to create a new transaction
      properties:
        transaction_type:
          type: string
          description: "Type of transaction (LOAN, REPAYMENT)"
          enum:
          - LOAN
          - REPAYMENT
          example: LOAN
        title:
          type: string
          description: Transaction title or description
          example: Dinner at restaurant
          maxLength: 50
          minLength: 0
        amount:
          type: integer
          format: int32
          description: Transaction amount in cents
          example: 5000
        currency_code:
          type: string
          description: Currency code (ISO 4217)
          example: JPY
          pattern: "^[A-Z]{3}$"
        date_str:
          type: string
          description: Transaction date in ISO 8601 format with timezone
          example: 2024-01-15T18:30:00+09:00
          pattern: "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}([+-]\\d{2}:\\d{2}|Z)$"
        payer_id:
          type: string
          format: uuid
          description: UUID of the user who paid
          example: 550e8400-e29b-41d4-a716-446655440000
        loan:
          $ref: "#/components/schemas/Loan"
          description: Loan details (required if transaction_type is LOAN)
        repayment:
          $ref: "#/components/schemas/Repayment"
          description: Repayment details (required if transaction_type is REPAYMENT)
      required:
      - amount
      - currency_code
      - date_str
      - payer_id
      - title
      - transaction_type
    Loan:
      type: object
      description: Loan details for transaction creation
      properties:
        obligations:
          type: array
          description: List of loan obligations specifying who owes what amount (max
            8)
          items:
            $ref: "#/components/schemas/Obligation"
          maxItems: 8
          minItems: 0
      required:
      - obligations
    Obligation:
      type: object
      description: Loan obligation specifying user and amount
      properties:
        amount:
          type: integer
          format: int32
          description: Amount owed in cents
          example: 2500
        user_uuid:
          type: string
          format: uuid
          description: UUID of the user who owes this amount
          example: 550e8400-e29b-41d4-a716-446655440000
      required:
      - amount
      - user_uuid
    Repayment:
      type: object
      description: Repayment details for transaction creation
      properties:
        recipient_id:
          type: string
          format: uuid
          description: UUID of the user receiving the repayment
          example: 550e8400-e29b-41d4-a716-446655440000
      required:
      - recipient_id
    CreateTransactionResponseDTO:
      type: object
      description: Detailed transaction information
      properties:
        transaction_id:
          type: string
          description: Transaction unique identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        transaction_type:
          type: string
          description: Type of transaction
          enum:
          - LOAN
          - REPAYMENT
          example: LOAN
        title:
          type: string
          description: Transaction title
          example: Dinner at restaurant
        amount:
          type: integer
          format: int64
          description: Transaction amount in cents
          example: 5000
        payer:
          $ref: "#/components/schemas/UserResponseDTO"
          description: User who made the payment
        exchange_rate:
          $ref: "#/components/schemas/ExchangeRateResponse"
          description: Exchange rate at the time of transaction
        date_str:
          type: string
          description: Transaction date (Tokyo time)
          example: 2024-01-15T18:30:00+09:00
        loan:
          $ref: "#/components/schemas/LoanResponse"
          description: Loan details (present if transaction_type is LOAN)
        repayment:
          $ref: "#/components/schemas/RepaymentResponse"
          description: Repayment details (present if transaction_type is REPAYMENT)
    ExchangeRateResponse:
      type: object
      description: Exchange rate information for a currency
      properties:
        currency_code:
          type: string
          description: ISO 4217 currency code
          example: USD
        jp_currency_name:
          type: string
          description: Currency name in Japanese
          example: 
        eng_currency_name:
          type: string
          description: Currency name in English
          example: US Dollar
        jp_country_name:
          type: string
          description: Country name in Japanese
          example: 
        eng_country_name:
          type: string
          description: Country name in English
          example: United States
        currency_symbol:
          type: string
          description: Currency symbol
          example: $
        symbol_position:
          type: string
          description: Position of currency symbol
          enum:
          - PREFIX
          - SUFFIX
        exchange_rate:
          type: string
          description: Exchange rate to JPY
          example: 150.25
    LoanResponse:
      type: object
      description: Loan details including all obligations
      properties:
        obligations:
          type: array
          description: List of loan obligations showing who owes how much
          items:
            $ref: "#/components/schemas/ObligationResponse"
    ObligationResponse:
      type: object
      description: Loan obligation for a specific user
      properties:
        user:
          $ref: "#/components/schemas/UserResponseDTO"
          description: User who owes this amount
        amount:
          type: integer
          format: int64
          description: Amount owed in cents
          example: 2500
    RepaymentResponse:
      type: object
      description: Repayment details
      properties:
        recipient:
          $ref: "#/components/schemas/UserResponseDTO"
          description: User receiving the repayment
    CreateAuthUserRequestDTO:
      type: object
      description: Request to create a new authenticated user
      properties:
        email:
          type: string
          description: User's email address
          example: john@example.com
          maxLength: 255
          minLength: 0
      required:
      - email
    UpdateUserNameRequestDTO:
      type: object
      description: Request to update user name
      properties:
        user_name:
          type: string
          description: User's display name
          example: John Doe
          maxLength: 50
          minLength: 1
      required:
      - user_name
    UpdateGroupNameRequestDTO:
      type: object
      description: Request to update group name
      properties:
        group_name:
          type: string
          description: New name for the group
          example: Summer Trip 2024
          maxLength: 100
          minLength: 0
      required:
      - group_name
    UpdateAppReviewRequestDTO:
      type: object
      description: Request to update app review preferences
      properties:
        app_review_status:
          type: string
          description: App review status
          enum:
          - PENDING
          - COMPLETED
          - PERMANENTLY_DECLINED
          example: COMPLETED
      required:
      - app_review_status
    TransactionSettlement:
      type: object
      description: Settlement transaction between two users
      properties:
        from:
          $ref: "#/components/schemas/UserResponseDTO"
          description: User who owes money
        to:
          $ref: "#/components/schemas/UserResponseDTO"
          description: User who is owed money
        amount:
          type: integer
          format: int64
          description: Amount to be settled in cents
          example: 3500
    TransactionSettlementResponseDTO:
      type: object
      description: Settlement information for a group
      properties:
        transactions_settlement:
          type: array
          description: List of settlements needed to balance accounts
          items:
            $ref: "#/components/schemas/TransactionSettlement"
    TransactionHistoryResponse:
      type: object
      description: Transaction history entry
      properties:
        transaction_id:
          type: string
          description: Transaction unique identifier
          example: 550e8400-e29b-41d4-a716-446655440000
        transaction_type:
          type: string
          description: Type of transaction
          enum:
          - LOAN
          - REPAYMENT
          example: LOAN
        title:
          type: string
          description: Transaction title
          example: Dinner at restaurant
        amount:
          type: integer
          format: int32
          description: Transaction amount in cents
          example: 5000
        exchange_rate:
          $ref: "#/components/schemas/ExchangeRateResponse"
          description: Exchange rate at the time of transaction
        date:
          type: string
          description: Transaction date (Tokyo time)
          example: 2024-01-15T18:30:00+09:00
    TransactionHistoryResponseDTO:
      type: object
      description: Transaction history response containing list of transactions
      properties:
        transactions_history:
          type: array
          description: List of transaction history entries
          items:
            $ref: "#/components/schemas/TransactionHistoryResponse"
    GroupListResponseDTO:
      type: object
      description: List of groups
      properties:
        group_list:
          type: array
          description: List of groups the user belongs to
          items:
            $ref: "#/components/schemas/GroupResponse"
    ExchangeRateResponseDTO:
      type: object
      description: Exchange rate list response
      properties:
        exchange_rate:
          type: array
          description: List of exchange rates
          items:
            $ref: "#/components/schemas/ExchangeRateResponse"
    Link:
      type: object
      properties:
        href:
          type: string
        templated:
          type: boolean
  securitySchemes:
    bearerAuth:
      type: http
      description: Firebase JWT token for user authentication
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      description: API Key for internal system operations (EventBridge + Lambda)
      name: X-API-Key
      in: header
